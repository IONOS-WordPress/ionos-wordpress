#
# this is the release workflow that is triggered by a pull requests to the main branch
#
# it will react to
# - created pull requests
# - pull request reviews
# - pull_request_review_comments
#
name: 'pull-request'

on:
  - pull_request_target
  - pull_request_review
  - pull_request_review_comment

jobs:
  send_notification:
    runs-on: ubuntu-latest
    name: Send message to gchat
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: ${{ github.ref }}
      - name: Get commit hash
        if: ${{ always() }}
        run: echo "::set-output name=sha8::$(echo ${GITHUB_SHA} | cut -c1-8)"
        id: slug
      - name: Hello world action step
        if: ${{ always() }}
        id: hello
        uses: DTherHtun/google-chat-action@v0.8
        with:
          project: ${{ github.repository }}
          commit: ${{ steps.slug.outputs.sha8 }}
          branch: ${{ github.ref }}
          status: ${{ job.status }}
          actionid: ${{ github.repository }}/runs/${{ github.run_id }}
          webhook: ${{ secrets.GOOGLECHAT_WPDEV_MERGE_REQUESTS_WEBHOOK }}
      # Use the output from the `hello` step
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"
