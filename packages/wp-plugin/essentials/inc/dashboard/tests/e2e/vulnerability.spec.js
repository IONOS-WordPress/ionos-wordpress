import { test, expect } from '@wordpress/e2e-test-utils-playwright';
import { execSync } from 'node:child_process';

test.describe('essentials:dashboard vulnerability block', () => {
  // Run this before all tests
  test.beforeAll(async () => {
    execSync(
      'pnpm -s run wp-env run tests-cli wp post delete $(pnpm -s run wp-env run tests-cli wp post list --format=ids --post_status=auto-draft,publish --post_type=ionos_dashboard,wp_global_styles) --force ||:'
    );
  });

  // Example test case that depends on the plugin
  test('Test for headline of block', async ({ admin, editor }) => {
    execSync('pnpm wp-env run tests-cli wp option update ionos_group_brand_name ionos');
    await admin.visitAdminPage('/post-new.php?post_type=ionos_dashboard');

    await editor.insertBlock({ name: 'ionos-dashboard-page/vulnerability' });

    const vulnerabilityBlock = await editor.canvas.getByRole('document', {
      name: 'Block: Vulnerability',
    });

    await expect(vulnerabilityBlock).toHaveCount(1);
    await expect(vulnerabilityBlock.locator('css=h3.wp-block-heading')).toHaveText('Vulnerability Scan');
  });
});
