{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "IONOS Loop telemetry schema",
  "description": "Schema for IONOS WordPress site configuration and telemetry data",
  "type": "object",
  "properties": {
    "hosting": {
      "type": "object",
      "description": "Hosting site configuration and metadata",
      "properties": {
        "locale": {
          "type": "string",
          "description": "WordPress locale setting",
          "examples": ["fr_FR", "en_US", "de_DE", "de_DE_formal"]
        },
        "blog_public": {
          "type": "boolean",
          "description": "Whether the blog is public"
        },
        "market": {
          "type": "string",
          "description": "Tenant market identifier",
          "examples": ["FR", "US", "DE"]
        },
        "tenant": {
          "type": "string",
          "description": "Tenant identifier",
          "examples": ["ionos"]
        },
        "core_version": {
          "type": "string",
          "description": "WordPress core version",
          "examples": ["6.8.1", "5.9.3"]
        },
        "php_version": {
          "type": "string",
          "description": "PHP version",
          "examples": ["8.1", "8.2", "7.4"]
        },
        "instance_created": {
          "type": "integer",
          "description": "UTC Unix timestamp when the instance was created"
        }
      },
      "required": ["locale", "blog_public", "market", "tenant", "core_version", "php_version", "instance_created"]
    },
    "wordpress": {
      "description": "WordPress site configuration and metadata",
      "type": "object",
      "properties": {
        "user_data": {
          "type": "object",
          "description": "User data struct returned by wordpress function count_users('memory')",
          "properties": {
            "total_users": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of users"
            },
            "avail_roles": {
              "type": "object",
              "description": "Available roles (key) and their user counts (value)",
              "additionalProperties": true
            }
          }
        },
        "active_theme": {
          "type": "object",
          "description": "Currently active WordPress theme",
          "properties": {
            "id": {
              "type": "string",
              "description": "Theme identifier/slug"
            },
            "version": {
              "type": "string",
              "description": "Theme version"
            },
            "parent_theme_slug": {
              "type": ["string", "null"],
              "description": "Parent theme slug for child themes"
            },
            "auto_update": {
              "type": "boolean",
              "description": "Whether auto-updates are enabled"
            }
          },
          "required": ["id", "version", "auto_update"]
        },
        "active_plugins": {
          "type": "array",
          "description": "List of active WordPress plugins",
          "items": {
            "type": "object",
            "required": ["plugin_slug", "version", "auto_update"],
            "properties": {
              "plugin_slug": {
                "type": "string",
                "description": "Plugin slug/identifier"
              },
              "version": {
                "type": "string",
                "description": "Plugin version"
              },
              "auto_update": {
                "type": "boolean",
                "description": "Whether auto-updates are enabled"
              }
            }
          }
        },
        "posts": {
          "type": "array",
          "description": "Post type statistics",
          "items": {
            "type": "object",
            "required": ["type", "count"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Post type",
                "examples": ["post", "page"]
              },
              "count": {
                "type": "integer",
                "description": "Number of posts of this type"
              }
            },
            "additionalProperties": true
          }
        },
        "comments": {
          "type": "object",
          "description": "Comment statistics and settings",
          "required": ["total", "comments_active"],
          "properties": {
            "total": {
              "type": "integer",
              "description": "Total number of comments"
            },
            "comments_active": {
              "type": "boolean",
              "description": "Whether comments are enabled site-wide"
            }
          }
        },
        "uploads": {
          "type": "object",
          "description": "Media library statistics",
          "required": ["file_count", "size"],
          "properties": {
            "file_count": {
              "type": "integer",
              "description": "Number of uploaded files"
            },
            "size": {
              "type": "integer",
              "description": "Total size of uploaded files in bytes.",
              "minimum": 0
            }
          },
          "additionalProperties": true
        },
        "installed_themes": {
          "type": "integer",
          "description": "Number of installed themes"
        },
        "installed_plugins": {
          "type": "integer",
          "description": "Number of installed plugins"
        },
        "permalink_structure": {
          "type": "string",
          "description": "WordPress permalink structure",
          "examples": ["/%postname%/", "/%year%/%monthnum%/%postname%/"]
        },
        "siteurl": {
          "type": "string",
          "description": "WordPress site URL"
        },
        "home": {
          "type": "string",
          "description": "WordPress home URL"
        }
      },
      "required": [
        "user_data",
        "active_theme",
        "active_plugins",
        "posts",
        "comments",
        "uploads",
        "installed_themes",
        "installed_plugins",
        "permalink_structure",
        "siteurl",
        "home"
      ]
    },
    "events": {
      "type": "array",
      "description": "Event statistics and settings",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Event name",
            "examples": ["login", "logout"]
          },
          "payload": {
            "type": "object",
            "description": "Event payload"
          },
          "timestamp": {
            "type": "integer",
            "description": "UTC Unix timestamp of the event"
          }
        },
        "required": ["name", "payload", "timestamp"]
      }
    },
    "clicks": {
      "type": "object",
      "description": "Click statistics and settings (key: click identifier, value: count)",
      "additionalProperties": true
    },
    "plugin_data": {
      "type": "object",
      "description": "Plugin-specific statistics and settings",
      "additionalProperties": true
    }
  },
  "required": ["hosting", "wordpress", "events", "clicks", "plugin_data"]
}
